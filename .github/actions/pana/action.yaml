name: Dart Package Workflow

inputs:
  min_score:
    required: false
    type: number
    default: 120
  pana_version:
    required: false
    type: string
  working_directory:
    required: false
    type: string
    default: "."
  dart_sdk:
    required: false
    type: string
    default: "stable"

runs:
  using: "composite"
  steps:
    - uses: dart-lang/setup-dart@v1
      with:
        sdk: ${{inputs.dart_sdk}}

    - working-directory: ${{ inputs.working_directory }}
      shell: ${{ inputs.shell }}
      run: dart pub global activate pana ${{inputs.pana_version}}

    - working-directory: ${{ inputs.working_directory }}
      shell: ${{ inputs.shell }}
      run: |
        PANA=$(pana . --no-warning); PANA_SCORE=$(echo $PANA | sed -n "s/.*Points: \([0-9]*\)\/\([0-9]*\)./\1\/\2/p")
        echo "Score: $PANA_SCORE"
        IFS='/'; read -a SCORE_ARR <<< "$PANA_SCORE"; SCORE=SCORE_ARR[0];
        if (( $SCORE < ${{inputs.min_score}} )); then echo "The minimum score of ${{inputs.min_score}} was not met!"; exit 1; fi