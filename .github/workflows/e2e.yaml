name: e2e

on:
  pull_request:
    branches:
      - main

defaults:
  run:
    working-directory: example

jobs:
  test_ios:
    strategy:
      matrix:
        test_file:
          - text_flow
      fail-fast: true

    runs-on: macos-latest

    steps:
      - name: 📚 Git Checkout
        uses: actions/checkout@v3

      - name: 🐦 Setup Local Fluttium Environment
        uses: ./.github/actions/local_fluttium_environment

      - name: 📦 Installing packages
        run: flutter pub get

      - name: 🔧 Setting Up Simulator
        id: simulator
        uses: futureware-tech/simulator-action@v2
        with:
          model: 'iPhone 11'

      - name: 🧪 Testing
        run: fluttium test --flavor development --target lib/main_development.dart -d ${{ steps.simulator.outputs.udid }} flows/${{ matrix.test_file }}.yaml

  test_macos:
    strategy:
      matrix:
        test_file:
          - text_flow
      fail-fast: true

    runs-on: macos-latest

    steps:
      - name: 📚 Git Checkout
        uses: actions/checkout@v3

      - name: 🐦 Setup Local Fluttium Environment
        uses: ./.github/actions/local_fluttium_environment

      - name: 📦 Installing packages
        run: flutter pub get

      - name: 🧪 Testing
        run: fluttium test -d macos flows/${{ matrix.test_file }}.yaml

  # test_android:
  #   strategy:
  #     matrix:
  #       test_file:
  #         - flows/text_flow.yaml
  #     fail-fast: true

  #   runs-on: macos-latest

  #   steps:
  #     - name: 📚 Git Checkout
  #       uses: actions/checkout@v3

  #     - name: 🐦 Setup Flutter
  #       uses: subosito/flutter-action@v2
  #       with:
  #         channel: stable
  #         cache: true

  #     - name: 📦 Installing packages
  #       run: |
  #         flutter pub get
  #         dart pub global activate --source path ../packages/fluttium_cli

  #     - name: 🧪 Testing
  #       uses: reactivecircus/android-emulator-runner@v2
  #       with:
  #         api-level: 29
  #         arch: x86_64
  #         profile: Nexus 6
  #         script: fluttium test ${{ matrix.test_file }}
